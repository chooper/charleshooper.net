
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>WordPress Auto Upgrade and &#8220;Dumb&#8221; Permissions - Charles Hooper</title>
  <meta name="author" content="Charles Hooper">

  
  <meta name="description" content="One of the nice features about WordPress is its ability to upgrade and
install plugins on the fly. This is nice because now you don’t need to
be &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.charleshooper.net/blog/wordpress-auto-upgrade-and-dumb-permissions">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/subversity" rel="alternate" title="Charles Hooper" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12888528-1']);
    _gaq.push(['_trackPageview']);

    setTimeout("_gaq.push(['_trackEvent', '60_seconds', 'read'])", 60000);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Charles Hooper</a></h1>
  
    <h2>Thoughts and projects from a Hacker and Operations Engineer</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/subversity" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.charleshooper.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
	<li><a href="/about/">About Charles</a></li>
	<li><a href="/projects/">Projects</a></li>
	<li><a href="/contact/">Contact</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">WordPress Auto Upgrade and &#8220;Dumb&#8221; Permissions</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-29T00:00:00-07:00" pubdate data-updated="true">Oct 29<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><h1></h1>

<p>One of the nice features about WordPress is its ability to upgrade and
install plugins on the fly. This is nice because now you don’t need to
be bothered with the hassle of downloading plugins, unzipping their
contents, and transferring them to your web server.</p>

<p>Unfortunately, the way in which WordPress determines if it has the
appropriate permissions to upgrade plugins is implemented poorly. When
WordPress doesn’t think it has permission, the admin panel will instead
<strong>prompt you for FTP login information</strong>. This is a problem because
sometimes WordPress will do this falsely even if it <em>does</em> have proper
permissions.</p>

<h2>The Problem</h2>

<p>The way WordPress tries to guess if it has proper permissions is very
primitive. Instead of using PHP’s <a href="http://us.php.net/manual/en/function.is-writable.php">is_writable</a>, WordPress instead
compares the web server’s User ID with the User ID of the wp-content
directory’s owner*. While this might work for a large number of cases,
it doesn’t work in all of them (including mine).</p>

<p>* It’s actually slightly more complicated than this, but the effect is the same.</p>

<h2>The Environment</h2>

<p>I run WordPress 3.x on Ubuntu 10.04 LTS under Lighttpd and PHP5-cgi.
Lighttpd runs as user <code>www-data</code> and group <code>www-data</code>. If I wanted to
let WordPress’ auto-detection of permissions work, I would have to
change the owner of my website directories to www-data. This doesn’t fly
with me, because I also want my user to have easy access to my document
root and don’t like the idea of my data being user-owned by my webserver
user.</p>

<h2>The Solution</h2>

<p>Instead of bending over to WordPress’ permission issues, I was able to
perform the following simple steps to have auto-installing/updating
plugins and themes <em>without </em>changing user ownership of my web files.</p>

<ol>
<li><p><code>sudo chgrp -R www-data /path/to/wp/wp-content</code></p>

<p> This changes group ownership of wp-content and all sub-directories
to be group-owned by your webserver user. wp-content is where WordPress
stores plugins, themes, cache files, and (AFAIK) file uploads.</p></li>
<li><p><code>sudo chmod -R g+w /path/to/wp/wp-content</code></p>

<p> This makes wp-content and all of its sub-directories group-writable.</p></li>
<li><p><code>sudo chmod g+s /path/to/wp/wp-content</code></p>

<p> This, <code>g+s,</code> is known as <strong>setgid</strong>. This causes newly-created files
to be group-owned by <code>wp-content</code>&#8217;s owning group, in this case <code>www-data</code>.</p></li>
<li><p>Finally, add the following to the bottom of <code>wp-config.php</code>. This is
an override built into the WordPress code. For more information, take a
look at <code>wp-admin/includes/file.php</code>&#8217;s function
<code>get_filesystem_method</code>.</p></li>
</ol>


<figure class='code'><figcaption><span>Enable direct file updating in wp-config.php </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">/* Force direct file updating</span>
</span><span class='line'><span class="x">- http://www.charleshooper.net/blog/wordpress-auto-upgrade-and-dumb-permissions/</span>
</span><span class='line'><span class="x">*/</span>
</span><span class='line'><span class="x">define(&#39;FS_METHOD&#39;, &#39;direct&#39;);</span>
</span></code></pre></td></tr></table></div></figure>


<p>So there you have it. WordPress does a poor job of properly detecting file permissions and, in some cases, needs to be overridden. If you’re still having problems after this, <strong>let me know</strong> and I will do my best to help you.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Charles Hooper</span></span>

      








  


<time datetime="2010-10-29T00:00:00-07:00" pubdate data-updated="true">Oct 29<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/wordpress/'>Wordpress</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.charleshooper.net/blog/wordpress-auto-upgrade-and-dumb-permissions/" data-via="charleshooper" data-counturl="http://www.charleshooper.net/blog/wordpress-auto-upgrade-and-dumb-permissions/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/rip-booksuggest/" title="Previous Post: RIP BookSuggest">&laquo; RIP BookSuggest</a>
      
      
        <a class="basic-alignment right" href="/blog/twitter-vs-erotica-your-corporas-source-matters/" title="Next Post: Twitter vs Erotica: Your Corpora&#8217;s Source Matters">Twitter vs Erotica: Your Corpora&#8217;s Source Matters &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<script type="text/javascript"><!--
		google_ad_client = "pub-9122341512723010";
		/* charleshooper.net sidebar */
		google_ad_slot = "2663139048";
		google_ad_width = 250;
		google_ad_height = 250;
		//-->
	</script>
	<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</section>
<section>
  <h1>About Charles</h1>
	<img src="/wp-content/uploads/me-150x150.jpg" alt="Charles Hooper"/>
	<p>Charles is a hacker with a background in systems and operations engineering. He enjoys hacking on side projects, gardening, and home brewing.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/personal-kaizen-self-improvement/">My Personal Kaizen</a>
      </li>
    
      <li class="post">
        <a href="/blog/about-this-site-technical/">About this site (technical)</a>
      </li>
    
      <li class="post">
        <a href="/blog/catching-up/">Catching up</a>
      </li>
    
      <li class="post">
        <a href="/blog/intro-to-ops-metrics-collection/">Intro to Operations: Metrics Collection</a>
      </li>
    
      <li class="post">
        <a href="/blog/intro-to-ops-availability-monitoring-alerting/">Intro to Operations: Availability Monitoring and Alerting</a>
      </li>
    
  </ul>
</section>

<section>
	<script type="text/javascript"><!--
		google_ad_client = "pub-9122341512723010";
		/* charleshooper.net sidebar */
		google_ad_slot = "2663139048";
		google_ad_width = 250;
		google_ad_height = 250;
		//-->
	</script>
	<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Charles Hooper -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'charleshooper';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.charleshooper.net/blog/wordpress-auto-upgrade-and-dumb-permissions/';
        var disqus_url = 'http://www.charleshooper.net/blog/wordpress-auto-upgrade-and-dumb-permissions/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

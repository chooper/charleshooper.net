
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Auto Type Juggling and Unsanitized Input - Charles Hooper</title>
  <meta name="author" content="Charles Hooper">

  
  <meta name="description" content="I would like to think that one day we will all be past the point where
we are constantly finding silly bugs and vulnerabilities caused by &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.charleshooper.net/blog/auto-type-juggling-and-unsanitized-input">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/subversity" rel="alternate" title="Charles Hooper" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12888528-1']);
    _gaq.push(['_trackPageview']);

    setTimeout("_gaq.push(['_trackEvent', '60_seconds', 'read'])", 60000);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Charles Hooper</a></h1>
  
    <h2>Thoughts and projects from a Hacker and Operations Engineer</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/subversity" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.charleshooper.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
	<li><a href="/about/">About Charles</a></li>
	<li><a href="/projects/">Projects</a></li>
	<li><a href="/contact/">Contact</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Auto Type Juggling and Unsanitized Input</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-04T00:00:00-08:00" pubdate data-updated="true">Dec 4<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><h1></h1>

<p>I would like to think that one day we will all be past the point where
we are constantly finding silly bugs and vulnerabilities caused by
unvalidated or unsanitized user input. Unfortunately for us all, we’re
not. In this article, I will attempt to describe a rather overlooked
result of <a href="http://www.php.net/manual/en/language.types.type-juggling.php">PHP’s type juggling</a>.</p>

<p>If you aren’t already familiar, type juggling is PHP’s way of
automatically switching or converting variables to different types based
on the context it’s being used in. For example, if you have the strings
“2″ and “3″ and you add them, PHP will convert them to integers and
return the integer 5. This is useful in PHP web-applications since any
variable that PHP retrieves from either GPC (<em>Get</em>, <em>Post</em>, <em>Cookie</em>)
variables or the database is considered a string. This is regardless of
its actual value or column type in the database and the string will need
to be converted to a numeric type before any type of math operations or
numeric comparisons can be performed on them.</p>

<p>On the lower-level, PHP is actually using libc’s strtod() function. If
we look at the man page, we learn If no conversion is performed, zero is
returned. Without looking at PHP’s source, it would seem to me that PHP
is blindly handing off string pointers to strtod() and if the type
conversion fails it will retain the type of whatever the variable was
last. This isn’t PHP’s fault, it’s the <em>developer’s responsibility</em> to
make sure the data he is using is properly sanitized!</p>

<p>The best real-world example I can give about this bug was a series of
exploits in the web-based RPG <a href="http://www.bootleggers.us/">Bootleggers</a> last round. One of the
most well known exploits in this series was known to players as “The Arm
Wrestling bug.” This arm wrestling bug was the result of a flaw or
limitation in PHP’s magic type switching that allowed players to bypass
certain logic checks to send extremely large strings of numbers to the
database backend and essentially create money out of thin air, one MySQL
signed integer (2,147,483,647) at a time.</p>

<p>For an example on how we would go about exploiting this, we look at the
following code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$var1 = '1';
</span><span class='line'>$var2 = '21';
</span><span class='line'>var_dump((bool) ($var1 &lt; $var2));
</span><span class='line'># Output: bool(true)</span></code></pre></td></tr></table></div></figure>


<p>All this code is doing is assigning strings to two variables and then
doing a numeric comparison of them — In our case, this script will
output “true” since, when evaluated as an integer, 1 is in fact
less-than 21. However, if there is any non-numeric data being passed to
the variable then strtod() will return 0 and PHP will evaluate these
variables as strings and use natural sorting to determine if one
variable is “less”-than another. Proof?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$var1 = '111 '; // there is a space before the closing quote
</span><span class='line'>$var2 = '21';
</span><span class='line'>var_dump((bool) ($var1 &lt; $var2));
</span><span class='line'># Output: bool(true)</span></code></pre></td></tr></table></div></figure>


<p>This block of code will <em>also</em> output true because the character ’1′ is
before the character ’2′ when using natural sorting. If a user is able
to bypass the logic checks with this exploit, then typically the string
will be sent straight to the database as-is (OK, maybe escaped for
apostrophes ;)). Depending on the DBMS there may be a variance in
behavior. Usually, exploiters will use this attack with a very large
string so that the column being updated with that value will actually
update to the maximum value for that column’s data type.</p>

<p>While exploits on web-based RPGs aren’t the end of the world, imagine if
your <em>bank</em> used a PHP-based web-application. Wouldn’t you feel better
if they all knew about his caveat and properly sanitized and validated
user input? :-)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Charles Hooper</span></span>

      








  


<time datetime="2009-12-04T00:00:00-08:00" pubdate data-updated="true">Dec 4<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/projects/'>Projects</a>, <a class='category' href='/blog/categories/uncategorized/'>Uncategorized</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.charleshooper.net/blog/auto-type-juggling-and-unsanitized-input/" data-via="charleshooper" data-counturl="http://www.charleshooper.net/blog/auto-type-juggling-and-unsanitized-input/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/ccnp-lab-recommendations/" title="Next Post: CCNP Lab Recommendations?">CCNP Lab Recommendations? &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
	</script>
	<ins class="adsbygoogle"
			 style="display:inline-block;width:250px;height:250px"
			 data-ad-client="ca-pub-9122341512723010"
			 data-ad-slot="3737400086"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
</section>
<section>
  <h1>About Charles</h1>
	<img src="/wp-content/uploads/me-150x150.jpg" alt="Charles Hooper"/>
	<p>Charles is a hacker with a background in systems and operations engineering. He enjoys hacking on side projects, gardening, and home brewing.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/why-i-moved-to-san-francisco/">Why I moved to San Francisco</a>
      </li>
    
      <li class="post">
        <a href="/blog/how-i-hacked-my-high-school/">How I Hacked My High School</a>
      </li>
    
      <li class="post">
        <a href="/blog/personal-kaizen-self-improvement/">My Personal Kaizen</a>
      </li>
    
      <li class="post">
        <a href="/blog/about-this-site-technical/">About this site (technical)</a>
      </li>
    
      <li class="post">
        <a href="/blog/catching-up/">Catching up</a>
      </li>
    
  </ul>
</section>

<section>
	<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
	</script>
	<ins class="adsbygoogle"
			 style="display:inline-block;width:250px;height:250px"
			 data-ad-client="ca-pub-9122341512723010"
			 data-ad-slot="3737400086"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Charles Hooper -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'charleshooper';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.charleshooper.net/blog/auto-type-juggling-and-unsanitized-input/';
        var disqus_url = 'http://www.charleshooper.net/blog/auto-type-juggling-and-unsanitized-input/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

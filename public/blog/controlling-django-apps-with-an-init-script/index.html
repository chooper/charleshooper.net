
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Controlling Django Apps with an Init Script - Charles Hooper</title>
  <meta name="author" content="Charles Hooper">

  
  <meta name="description" content="If you’re reading this, you probably already know that an init script is a specific style of script that allows you to control daemon processes. In &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.charleshooper.net/blog/controlling-django-apps-with-an-init-script">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/subversity" rel="alternate" title="Charles Hooper" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12888528-1']);
    _gaq.push(['_trackPageview']);

    setTimeout("_gaq.push(['_trackEvent', '60_seconds', 'read'])", 60000);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Charles Hooper</a></h1>
  
    <h2>Thoughts and projects from a Hacker and Engineering Manager</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/subversity" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.charleshooper.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
	<li><a href="/about/">About Charles</a></li>
	<li><a href="/projects/">Projects</a></li>
	<li><a href="/contact/">Contact</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Controlling Django Apps With an Init Script</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-29T00:00:00-07:00" pubdate data-updated="true">May 29<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><h1 id="section"></h1>

<p>If you’re reading this, you probably already know that an init script is a specific style of script that allows you to control daemon processes. In particular, they are used to start processes at boot and terminate them at shutdown. What follows is an example script I use to control one of my Django FastCGI projects. This particular example was written for Ubuntu and Debian but could probably be modified for RedHat/CentOS or other distros.</p>

<p>Please refer to your Distro’s documentation on how to install and activate init scripts (hint: See /etc/init.d/ and the man page for update-rc.d if on Debian or Ubuntu.)</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>django-fcgi-init.sh</span><a href="https://gist.github.com/anonymous/997829#file-django-fcgi-init-sh">link</a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line"><span class="c">#!/bin/sh</span>
</span><span class="line">
</span><span class="line"><span class="nv">PATH</span><span class="o">=</span>/sbin:/bin:/usr/sbin:/usr/bin
</span><span class="line">
</span><span class="line"><span class="nv">FCGIHOST</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span>
</span><span class="line"><span class="nv">FCGIPORT</span><span class="o">=</span><span class="s2">&quot;5000&quot;</span>
</span><span class="line"><span class="nv">RUNAS</span><span class="o">=</span><span class="s2">&quot;projectuser:projectgroup&quot;</span>
</span><span class="line"><span class="nv">UMASK</span><span class="o">=</span><span class="s2">&quot;200&quot;</span>
</span><span class="line"><span class="nv">DAEMON</span><span class="o">=</span><span class="s2">&quot;/path/to/django/manage.py&quot;</span>
</span><span class="line"><span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;MyProject&quot;</span>
</span><span class="line"><span class="nv">DESC</span><span class="o">=</span><span class="s2">&quot;My Django Project&quot;</span>
</span><span class="line"><span class="nv">RUNDIR</span><span class="o">=</span>/var/run/<span class="nv">$NAME</span>
</span><span class="line"><span class="nv">PIDFILE</span><span class="o">=</span>/var/run/<span class="nv">$NAME</span>/<span class="nv">$NAME</span>.pid
</span><span class="line"><span class="nv">ENV</span><span class="o">=</span><span class="s2">&quot;env -i LANG=C PATH=/usr/local/bin:/usr/bin:/bin&quot;</span>
</span><span class="line"><span class="nv">SSD</span><span class="o">=</span><span class="s2">&quot;/sbin/start-stop-daemon&quot;</span>
</span><span class="line">
</span><span class="line"><span class="nv">DAEMON_OPTS</span><span class="o">=</span><span class="s2">&quot;runfcgi host=$FCGIHOST port=$FCGIPORT pidfile=$PIDFILE</span>
</span><span class="line"><span class="s2">daemonize=true&quot;</span>
</span><span class="line">
</span><span class="line"><span class="nb">test</span> -x <span class="nv">$DAEMON</span> <span class="o">||</span> <span class="nb">exit </span>0
</span><span class="line">
</span><span class="line"><span class="nb">set</span> -e
</span><span class="line">
</span><span class="line">. /lib/lsb/init-functions
</span><span class="line">
</span><span class="line"><span class="c"># Set up /var/run directory to write out pidfile</span>
</span><span class="line">mkdir -p <span class="s2">&quot;$RUNDIR&quot;</span>
</span><span class="line">chown <span class="s2">&quot;$RUNAS&quot;</span> <span class="s2">&quot;$RUNDIR&quot;</span>
</span><span class="line">chmod 775 <span class="s2">&quot;$RUNDIR&quot;</span>
</span><span class="line">
</span><span class="line"><span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
</span><span class="line"> start<span class="o">)</span>
</span><span class="line"> log_daemon_msg <span class="s2">&quot;Starting $DESC&quot;</span> <span class="nv">$NAME</span>
</span><span class="line"> <span class="k">if</span> ! start-stop-daemon --start --quiet --oknodo <span class="se">\</span>
</span><span class="line"> --pidfile <span class="nv">$PIDFILE</span> --umask <span class="s2">&quot;$UMASK&quot;</span> --chuid <span class="s2">&quot;$RUNAS&quot;</span> <span class="se">\</span>
</span><span class="line"> --exec <span class="nv">$DAEMON</span> -- <span class="nv">$DAEMON_OPTS</span>
</span><span class="line"> <span class="k">then</span>
</span><span class="line"><span class="k"> </span>log_end_msg 1
</span><span class="line"> <span class="k">else</span>
</span><span class="line"><span class="k"> </span>chmod 400 <span class="nv">$PIDFILE</span>
</span><span class="line"> log_end_msg 0
</span><span class="line"> <span class="k">fi</span>
</span><span class="line"> ;;
</span><span class="line"> stop<span class="o">)</span>
</span><span class="line"> log_daemon_msg <span class="s2">&quot;Stopping $DESC&quot;</span> <span class="nv">$NAME</span>
</span><span class="line"> <span class="k">if</span> <span class="o">[</span> -f <span class="nv">$PIDFILE</span> <span class="o">]</span>; <span class="k">then</span>
</span><span class="line"><span class="k"> </span><span class="nb">kill</span> <span class="sb">`</span>cat -- <span class="nv">$PIDFILE</span><span class="sb">`</span>
</span><span class="line"> rm -f -- <span class="nv">$PIDFILE</span>
</span><span class="line"> log_end_msg 0
</span><span class="line"> <span class="k">fi</span>
</span><span class="line"> ;;
</span><span class="line"> restart|force-reload<span class="o">)</span>
</span><span class="line"> <span class="nv">$0</span> stop
</span><span class="line"> <span class="nv">$0</span> start
</span><span class="line"> ;;
</span><span class="line"> status<span class="o">)</span>
</span><span class="line"> status_of_proc -p <span class="s2">&quot;$PIDFILE&quot;</span> <span class="s2">&quot;$DAEMON&quot;</span> <span class="s2">&quot;$NAME&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">exit </span>0 <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
</span><span class="line"> ;;
</span><span class="line"> *<span class="o">)</span>
</span><span class="line"> <span class="nb">echo</span> <span class="s2">&quot;Usage: $0 {start|stop|restart|force-reload|status}&quot;</span> &gt;&amp;2
</span><span class="line"> <span class="nb">exit </span>1
</span><span class="line"> ;;
</span><span class="line"><span class="k">esac</span>
</span><span class="line">
</span><span class="line"><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure></notextile></div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Charles Hooper</span></span>

      








  


<time datetime="2011-05-29T00:00:00-07:00" pubdate data-updated="true">May 29<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/development/'>Development</a>, <a class='category' href='/blog/categories/system-administration/'>System Administration</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.charleshooper.net/blog/controlling-django-apps-with-an-init-script/" data-via="charleshooper" data-counturl="http://www.charleshooper.net/blog/controlling-django-apps-with-an-init-script/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/one-moms-way-of-getting-things-done/" title="Previous Post: One Mom&#8217;s Way of Getting Things Done">&laquo; One Mom&#8217;s Way of Getting Things Done</a>
      
      
        <a class="basic-alignment right" href="/blog/common-single-point-of-failure-people/" title="Next Post: Common Single Point of Failure: People">Common Single Point of Failure: People &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <!-- Ads removed -->
</section>
<section>
  <h1>About Charles</h1>
	<img src="http://www.gravatar.com/avatar/9f645d339b731bc99a95704ad4289aac.png?size=160" alt="Charles Hooper"/>
	<p>Charles is an engineering manager at Heroku. He enjoys archery, smoking meat, gardening, home brewing, and hacking.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/on-slack-and-upkeep/">On Slack and Upkeep</a>
      </li>
    
      <li class="post">
        <a href="/blog/what-i-do-sre/">What I Do as an SRE</a>
      </li>
    
      <li class="post">
        <a href="/blog/actual-email-from-recruiter/">An actual email from a recruiter</a>
      </li>
    
      <li class="post">
        <a href="/blog/troubleshooting-elbs-with-elbping/">Troubleshooting ELBs with elbping</a>
      </li>
    
      <li class="post">
        <a href="/blog/my-def-con-21-experience/">My DEF CON 21 Experience</a>
      </li>
    
  </ul>
</section>

<section>
  <!-- Ads removed -->
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Charles Hooper -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'charleshooper';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.charleshooper.net/blog/controlling-django-apps-with-an-init-script/';
        var disqus_url = 'http://www.charleshooper.net/blog/controlling-django-apps-with-an-init-script/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

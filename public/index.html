
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Charles Hooper</title>
  <meta name="author" content="Charles Hooper">

  
  <meta name="description" content="tl;dr Moved to San Francisco
Took time off to decompress
Joined team at Heroku
Loving it --verbose It&#8217;s been a while since I&#8217;ve posted, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.charleshooper.net">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/subversity" rel="alternate" title="Charles Hooper" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12888528-1']);
    _gaq.push(['_trackPageview']);

    setTimeout("_gaq.push(['_trackEvent', '60_seconds', 'read'])", 60000);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Charles Hooper</a></h1>
  
    <h2>Thoughts and projects from a Hacker and Operations Engineer</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/subversity" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.charleshooper.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
	<li><a href="/about/">About Charles</a></li>
	<li><a href="/projects/">Projects</a></li>
	<li><a href="/contact/">Contact</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/catching-up/">Catching Up</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-22T04:45:00-07:00" pubdate data-updated="true">Jun 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<h2>tl;dr</h2>

<ul>
<li>Moved to San Francisco</li>
<li>Took time off to decompress</li>
<li>Joined team at Heroku</li>
<li>Loving it</li>
</ul>


<h2><code>--verbose</code></h2>

<p>It&#8217;s been a while since I&#8217;ve posted, but I wanted to let you know that
I&#8217;m still alive! Things were very hectic due to a few life changes but I
much of the dust has settled now and I&#8217;m excited to talk about what
those changes are.</p>

<p>But first, some history.</p>

<p>In 2011, I was a junior at university studying Business
Information Systems. I had some prior systems engineering and operations
experience and was paying my tuition by performing contract work for a
company that doesn&#8217;t exist today. While at this company, I worked very
closely with a developer and the two of us were responsible for running
this company&#8217;s infrastructure. Neither of us had the time or the
willpower to be bothered by operational tasks, so we automated
everything. Even though our environment was much smaller (somewhere
between 30-50 instances in EC2) than many others, we had alot of things
that many companies are lacking:</p>

<ul>
<li>New services were in configuration management</li>
<li>New deployments were almost entirely automated</li>
<li>We had good visibility with a variety of metrics being reported to Ganglia and Graphite</li>
<li>We even had a reasonable nagios configuration</li>
</ul>


<p>Around this time, the term <strong>devops</strong> was being tossed around on twitter
on a more frequent basis. I can remember actually having a Google Alert
for the term to email me when there were new blog posts about it and it
<em>not</em> being spammy. I have a love/hate relationship with the term, and
in December 2011 I wrote my blog post <a href="/blog/concurrent-engineering-the-foundation-of-devops/">Concurrent Engineering: The
Foundation of DevOps</a> in which I argued that the ideas behind devops
weren&#8217;t new, but were maybe old ideas from business that were recently
independtly re-discovered.</p>

<p>The blog post wasn&#8217;t very popular, but Solomon Hykes (CEO of dotCloud)
managed to see it and, thinking we had very similar ideas about devops,
invited me to interview for a position on their newly formed Site
Reliability Engineering team. I got the job at dotCloud, and up until
April of this year that&#8217;s where I stayed.</p>

<p>In mid-April, I resigned from my position at dotCloud and moved to San
Francisco. There were a number of reasons for the resignation but chief
among them was that I needed some time to decompress and all of my paid
time-off had been used up following my youngest brother&#8217;s car accident.
This ended up being an awesome decision because it gave me my
much-needed decompression time and I was able to explore my new city.</p>

<p>I took about four weeks off before I put any real effort towards a job
search. The move to San Francisco and the job search alone could fill
two entirely-too-verbose blog posts but the end result was that I moved
here safely and joined the team at <a href="http://www.heroku.com/">Heroku</a>!</p>

<p>Fast forward to today and I&#8217;ve just finished my third week at Heroku.
It&#8217;s an amazing experience, a great team, and an awesome culture that is
encapsulated in the following quote:</p>

<blockquote><p>I like our culture. We welcome failure into our house and then kick
its teeth in.</p></blockquote>

<p>I&#8217;ll write more about this another time. For now, thank you for
listening to my story.</p>

<p>&mdash; Charles</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/intro-to-ops-metrics-collection/">Intro to Operations: Metrics Collection</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-07T14:51:00-07:00" pubdate data-updated="true">May 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<p><em>I&#8217;m writing a series of blog posts for managers and other people
without an operations background in order to introduce certain best
practices regarding Operations. For the rest of the blog posts, please
visit the <a href="/blog/intro-to-ops-for-startups/">introductory Intro to Operations</a> blog post!</em></p>

<p>Collecting metrics is another area that many early stage startups seem
to overlook even though it is probably one of the most important things
they can do. By metrics collection, I am referring to the gathering and
storing of various metrics at several different levels. As John Allspaw
identifies them in <a href="http://www.amazon.com/Web-Operations-Keeping-Data-Time/dp/1449377440">Web Operations: Keeping the Data on Time</a>, they
are:</p>

<ul>
<li><strong>High-level business and application metrics</strong> (e.g. user sign-ups)</li>
<li><strong>Feature-specific application-level metrics</strong> (e.g. widgets processed)</li>
<li><strong>Systems and service-level metrics</strong> (e.g. server load or database queries per second)</li>
</ul>


<p>You&#8217;ll note that there are two levels of &#8220;application-level&#8221; metrics.
The higher-level application metrics are mostly those that can be tied
to business objectives, while the other category of application metrics
are generally more feature specific.</p>

<p>Benefits incurred by collecting these metrics are plentiful. For one,
having quick access to these metrics is helpful during troubleshooting
and incident response. For example, I was once hired under contract to
look into why a certain company&#8217;s API was unreliable for the previous
few months. At least once per day, this company&#8217;s API would time out and
not respond to client requests. After enabling basic metrics collection
for the servers and services used by the API, it very quickly became
obvious that the database servers were reaching their connection limits
which was preventing the API from retrieving records from the database.
Not only was this problem identified very quickly, but later on we were
able to look back at our metrics data to assess how close to our limits
we were getting.</p>

<p>Another benefit is that you can integrate the metrics into your
<a href="/blog/intro-to-ops-availability-monitoring-alerting/">Availability monitoring</a> system to be alerted when metrics surpass
some threshold or change significantly. Not only that, but analyzing
these metrics will allow you to manage your capacity intelligently and
build a business case to justify infrastructure expenditures. Finally,
analyzing these metrics will also give you insight into your
application, how it&#8217;s used, and your business.</p>

<p>How you go about collecting and storing these metrics is up to you. Many
engineers might be tempted to build their own solution; however, there
are many open source and third party software packages that you may find
helpful. Key considerations when choosing which package or packages to
use are:</p>

<ul>
<li>The ability to add new, custom metrics</li>
<li>Configurable resolution/storage trade-off</li>
<li>Integration with availability monitoring and alerting systems</li>
<li>Graphing/visualization</li>
</ul>


<p>If your startup doesn&#8217;t have any metrics then you should start
collecting them now. The visualization will help you in the short run
and the historical data will help you in the long run.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/intro-to-ops-availability-monitoring-alerting/">Intro to Operations: Availability Monitoring and Alerting</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-05T21:57:00-07:00" pubdate data-updated="true">May 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<p><em>I&#8217;m writing a series of blog posts for managers and other people
without an operations background in order to introduce certain best
practices regarding Operations. For the rest of the blog posts, please
visit the <a href="/blog/intro-to-ops-for-startups/">introductory Intro to Operations</a> blog post!</em></p>

<p>Another area I&#8217;ve seen alot of early stage startups lacking in is
<strong>availability monitoring and alerting</strong>. The essence of availability
monitoring and alerting is being notified when your service is not
working as expected, including when it&#8217;s simply down, isn&#8217;t meeting
formal or informal SLAs (e.g., it&#8217;s too slow), or certain functionality
is broken.</p>

<p>What I typically see is that some effort was made to set up this type of
monitoring before and never maintained. Symptoms include <em>poor
monitoring coverage</em> (<em>servers missing from the config, services
monitoring nearly non-existent</em>), <em>large amounts of false positives and
negatives</em>, <em>inactionable alerts</em>, and <em>alerts that go unignored</em>
because of the previous issues.</p>

<p>Symptoms on the business include not knowing when your service is down
and finding out that your service is broken <em>from your customers</em>.
Finding out that your service is down from your customers is not only
embarrassing but it also shakes their confidence in you, affects your
reputation, and may even lead to lost revenue.</p>

<p>The good news is that it doesn&#8217;t have to be this way. When availability
monitoring is set up properly, maintained, and you and your employees
agree to approach alerts a specific way, you will be able to reap a
variety of benefits. Here&#8217;s what I recommend:</p>

<ol>
<li><p>First, collaborate with your employees to define who is in the pager
rotation and the escalation policies. Ask yourself: What happens when
the on call engineer is overwhelmed and needs backup? What happens when
the engineer goes on vacation?</p></li>
<li><p>Next, take inventory of what services you rely on and define an
internal SLA for them. This does not have to be a super formal process,
but this inventory and SLA will be helpful for deciding what thresholds
to set in your monitoring to avoid false positives. Try to see the big
picture and think about everything such as:</p>

<ul>
<li>Servers,</li>
<li>Self-managed supporting services like web servers, databases, email services,</li>
<li>Application functionality and features - one strategy I like is exposing a &#8220;health check&#8221; service that can be checked by the monitoring agent,</li>
<li>Third party services like remote APIs.</li>
</ul>


<p>Your inventory and SLA definition is a living document; remember to
keep it up to date!</p></li>
<li><p>Then set up whatever monitoring package you or your engineers decided
to use (self-hosted or third party) such as <a href="http://www.nagios.org/">nagios</a>, <a href="http://www.zenoss.com/">Zenoss</a>,
<a href="http://www.pingdom.com/">Pingdom</a>, or <a href="http://www.copperegg.com/">CopperEgg</a> and have your monitoring configured for
those services. If you&#8217;re really good, you&#8217;ll <em>check your configuration
into its own source control repository</em>. If you go the self-hosted
route, it may also be worth having your monitoring server monitored
externally.  Who&#8217;s watching the watcher indeed.</p></li>
<li><p>Think about integrating your monitoring with a pager service such as
<a href="http://www.pagerduty.com/">PagerDuty</a>. Services like PagerDuty allow you to input your pager
rotation and then define good rules for how to contact the on call
engineer and when to escalate should the engineer be unavailable.</p></li>
<li><p>With improved monitoring and alerting in place, you may want to think
about giving certain customers &#8220;911&#8221; access. At a previous company I
worked at, we had a secret email address our big customers could hit
which would <em>open a support ticket</em> and then <em>page the on call engineer</em>
with the ticket number. If you decide to go this route; however, you&#8217;ll
want to <em>train your customers</em> when it&#8217;s appropriate to use this power
and how to use it most effectively.</p></li>
<li><p>Adjust alerts and fix problems as you get paged for them. Don&#8217;t care
that a particular API goes down during a known maintenance window?
Schedule the notification policy accordingly.</p></li>
<li><p>Finally, continue maintaining your inventory and monitoring
service&#8217;s configuration. For extra benefit, consider tracking your
organization&#8217;s <strong>Mean Time To Respond</strong> (how long it took for engineer to
acknowledge that something is wrong) and your <strong>Mean Time To Recover</strong>
(how long it took the engineer to resolve the issue <em>including</em> the Mean
Time To Respond), your <strong>Mean Time Between Failures</strong> (self-explanatory,
I hope), and <strong>Percent Availability</strong> (what percent of time your service
is functional in a given period of time).</p></li>
</ol>


<p>This concludes the management and non-ops introduction to operations; I
hope you find this helpful.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/intro-to-ops-config-management/">Intro to Operations: Configuration Management</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-05T20:12:00-07:00" pubdate data-updated="true">May 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<p><em>I&#8217;m writing a series of blog posts for managers and other people
without an operations background in order to introduce certain best
practices regarding Operations. For the rest of the blog posts, please
visit the <a href="/blog/intro-to-ops-for-startups/">introductory Intro to Operations</a> blog post!</em></p>

<p>One of the areas I&#8217;ve witnessed early stage startups lacking in is
<strong>configuration management</strong>. <em>Configuration management is the process of
standardizing and enforcing configurations</em>. In other words,
configuration management is about deciding on a specific configuration
of services for various roles and then applying these configurations in
practice. Typically, these manifests are written in (domain-specific)
language and is specific to the <em>configuration management software</em>
being used, such as <a href="https://puppetlabs.com/">puppet</a>, <a href="http://www.opscode.com/chef/">chef</a>, <a href="http://cfengine.com/">cfengine</a>, or
<a href="http://saltstack.com/community.html">salt stack</a>.</p>

<p>There are many benefits to configuration management. For one,
configuration management allows developers to spend more time working on
the product and less time deploying new services. This is because
configuration is now automated and faster as a result. In addition,
environments are standardized and therefore less time is spent
troubleshooting or diagnosing edge cases in different environments.
Finally, when coupled with <em>source control management</em>, the proper use
of configuration management can be used to track and audit what has
changed over time and who changed it.</p>

<p>In many of these early stage startups, there is either very little
configuration management performed at all, or configuration management
exists as a series of shell scripts cobbled together to do some
post-hardware setup. If you&#8217;re lucky, there exists a document somewhere
that describes when and how to run these scripts to deploy new services.</p>

<p>The way configuration management works is that engineers create a
collection of files that define how the system should be configured.
This collection of files is typically called a <strong>manifest</strong>. Then, once
physical or virtual hardware has been provisioned, one of these
manifests is <em>applied</em> to the new host. During application, the
configuration management software will interpret the new configuration,
install software packages, manage users and credentials, alter config
files, manage file permissions, run arbitrary commands, and so on. Once
the manifest is fully applied, the new host should be fully configured
and ready to be used!  In some environments; however, they may be a
post-host-provisioning step where additional work is performed
afterwards, such as checking out application code from a source control
repository.</p>

<p>If you&#8217;re not using configuration management already then you should
start now because, frankly, it&#8217;s never too early. Starting configuration
management now will not only help your first hired ops/systems engineer
from working backwards to write these manifests later, but will also
incur benefits (such as your developers spending less time away from
shipping value-added code) that will outweigh the initial learning
curve.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/new-platform/sorry-for-rss-spam/">New Platform - Sorry for the RSS Spam</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-05T15:58:00-07:00" pubdate data-updated="true">May 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<p>Sorry for the RSS spam, everyone. I switched blogging platforms recently
from <a href="http://wordpress.org/">Wordpress</a> to <a href="http://octopress.org/">Octopress</a>. When I updated my feed URL in
<a href="http://feedburner.google.com/">Feedburner</a>; however, I&#8217;m told it re-posted all of my previous blog
posts in multiple RSS readers as unread. This resulted in a ton of
annoying spam for alot of people, particularly those using <a href="http://www.feedly.com/">Feedly</a>
and Google Reader.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/intro-to-ops-for-startups/">Intro to Operations for Early Stage Startups</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-04T21:37:00-07:00" pubdate data-updated="true">May 4<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<p>I&#8217;ve spent the last few years in a variety of roles for early stage tech
startups. While in these roles, I&#8217;ve noticed a pattern: <em>Early stage
startups don&#8217;t give much thought to their operations. In particular,
they typically don&#8217;t hire anyone specifically for that role because they
are focused on building their product.</em> In other words, all of their
technical hires are for developers.</p>

<p>What tends to happen in my experience is that <em>their developers soon
become overwhelmed</em> (especially after a growth spurt) and are unable to
spend their time shipping code that&#8217;s going to improve their product or
make their company money. Eventually, if they&#8217;re lucky, management catches
onto this and hires their first <strong>systems or operations engineer</strong>.</p>

<p>Because I&#8217;ve had the opportunity to be first-hired systems engineer,
what I&#8217;ve experienced is the effect of &#8220;working backwards&#8221; to undo a
bunch of things that weren&#8217;t done following best practices while
simultaneously moving things forward to improve them.</p>

<p>I decided to try to educate whoever would be willing to read this
(hopefully early stage startups!) about some <em>best practices</em> that will
not only save their future operations engineers some headache, but will
also improve their business. Part of this education will happen in the
form of one-on-one time with these startups. For example, I spent the
last couple of days sitting in on office hours at a startup accelerator.
The other part; however, will take place by writing &#8220;Intro to&#8230;&#8221;
articles and publishing them to a variety of places, including this blog.</p>

<p>Specifically, the topics I&#8217;ve chosen to write about are:</p>

<ul>
<li><a href="/blog/intro-to-ops-config-management/">Configuration management</a></li>
<li><a href="/blog/intro-to-ops-availability-monitoring-alerting/">Availability monitoring</a></li>
<li><a href="/blog/intro-to-ops-metrics-collection/">Metrics collection</a></li>
<li>Backups</li>
<li>Security</li>
<li>Disaster Recovery</li>
</ul>


<p>Over the next week or so, I&#8217;ll write about each one of these topics and
post them to this blog. I hope people find them helpful!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-annual-review/">2012 Annual Review</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-14T00:00:00-08:00" pubdate data-updated="true">Jan 14<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<p>Here are some stats from 2012:</p>

<ul>
<li>Only 3 posts published.</li>
<li>50,791 pageviews.</li>
<li>36,176 visitors (32,007 unique)</li>
<li>71.97% bounce rate.</li>
<li>Same great position at dotCloud!</li>
</ul>


<p>Interestingly, my stats compared to last year aren’t too different, despite the fact that I only wrote 3 blog posts this year (instead of 10 last year). What’s also interesting is the HUGE spike in bounce rate (which used to be almost non-existent). This spike begins right around the time I hit a “home run” in terms of driving new traffic.</p>

<p>Going forward, I am going to try to post more (<em>again</em>). I’ve said this before but have yet to succeed. This time around, I changed my posting rules to allow me to write about topics more personal to me or more opinionated in nature.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/year-end-highlights/">An Early Year-end Review &#8211; Highlights</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-16T00:00:00-08:00" pubdate data-updated="true">Dec 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<p>Since I’ve only written 3 blog posts so far this year and alot has changed, here’s a brief summary of what I’ll be writing about in my annual review:</p>

<ul>
<li>I stopped doing contract work and started working for dotCloud part time,</li>
<li>As of tomorrow, I’ll officially have completed the requirements for my Bachelor’s degree,</li>
<li>I found myself, politically (I won’t be writing about this, but it is a big deal to me).</li>
</ul>


<p>What does the future hold for me?</p>

<ul>
<li>dotCloud offered me a full time position and I accepted; I will start January 2nd,</li>
<li>I have a variety of side projects planned but it’s too soon to tell how much of my free time I’ll want to spend on them,</li>
<li>I hope to become more involved with my local community and the ACM,</li>
<li>I’ve made the decision to stop writing so much on Facebook and Twitter and write more here.</li>
</ul>


<p>That last item has big implications for this blog. It means that I’ll be writing about more personal subjects and opinions I have instead of wasting that effort on Twitter and Facebook (where relatives I haven’t seen in 20 years take the opportunities to rant on my wall). Some of these opinions may also be controversial and, that’s OK, we’re meant to disagree on some things. Some of them may even be ill-formed as they’ll be outside of my area of expertise. That’s OK too, just write me and educate me.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/painless-instrumentation-of-celery-tasks-using-statsd-and-graphite/">Painless Instrumentation of Celery Tasks Using Statsd and Graphite</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-12T00:00:00-07:00" pubdate data-updated="true">Mar 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<p><img src="http://www.charleshooper.net/wp-content/uploads/400px-Steuerstand01-150x150.jpg" title="A Control Station" alt="" />
For one of my clients and side projects, we’ve been working hard to build in application-level metrics to our wide portfolio of services. Among these services is one built on top of the <a href="http://celeryproject.org/">Celery distributed task queue</a>. We wanted a system that required as little configuration as possible to publish new metrics. For this reason, we decided on using <a href="http://codeascraft.etsy.com/2011/02/15/measure-anything-measure-everything/">statsd</a> and <a href="http://graphite.wikidot.com/">graphite</a>. Getting statsd and graphite running was the easy part, but we needed a quick, painless way of adding the instrumentation code for the most basic metrics to our Celery-backed service.</p>

<p>For us, those basic metrics consisted of:</p>

<ul>
<li>Number of times a worker starts on a specific task</li>
<li>Number of times a task raises an exception</li>
<li>Number of times a task completes successfully (no exceptions)</li>
<li>How long each task takes to complete</li>
</ul>


<p>Since the code to enable these metrics just <em>wraps</em> the code being instrumented it seemed only natural to use a decorator. Below is the code I wrote to do just that.</p>

<figure class='code'><figcaption><span>statsd_instrument.py</span><a href='https://gist.github.com/chooper/2018362'>link</a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="sd">&quot;&quot;&quot;Decorator to quickly add statsd (graphite) instrumentation to Celery</span>
</span><span class='line'><span class="sd">task functions.</span>
</span><span class='line'>
</span><span class='line'><span class="sd">With some slight modification, this could be used to instrument just</span>
</span><span class='line'><span class="sd">about any (non-celery) function and be made abstract enough to customize</span>
</span><span class='line'><span class="sd">metric names, etc.</span>
</span><span class='line'>
</span><span class='line'><span class="sd">Stats reported include number of times the task was accepted by a worker</span>
</span><span class='line'><span class="sd">(`started`), the number of successes, and the number of times the task</span>
</span><span class='line'><span class="sd">raised an exception. In addition, it also reports how long the task took</span>
</span><span class='line'><span class="sd">to complete. Usage:</span>
</span><span class='line'>
</span><span class='line'><span class="sd">&gt;&gt;&gt; @task</span>
</span><span class='line'><span class="sd">&gt;&gt;&gt; @instrument_task</span>
</span><span class='line'><span class="sd">&gt;&gt;&gt; def mytask():</span>
</span><span class='line'><span class="sd">&gt;&gt;&gt;     # do stuff</span>
</span><span class='line'><span class="sd">&gt;&gt;&gt;     pass</span>
</span><span class='line'>
</span><span class='line'><span class="sd">Please note that the order of decorators is important to Celery. See</span>
</span><span class='line'><span class="sd">http://ask.github.com/celery/userguide/tasks.html#decorating-tasks</span>
</span><span class='line'><span class="sd">for more information.</span>
</span><span class='line'>
</span><span class='line'><span class="sd">Uses `simple_decorator` from</span>
</span><span class='line'><span class="sd">http://wiki.python.org/moin/PythonDecoratorLibrary#Property_Definition</span>
</span><span class='line'>
</span><span class='line'><span class="sd">Limitation: Does not readily work on subclasses of celery.tasks.Task</span>
</span><span class='line'><span class="sd">because it always reports `task_name` as &#39;run&#39;</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># statsd instrumentation</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">current_app</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">statsd</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@simple_decorator</span>
</span><span class='line'><span class="k">def</span> <span class="nf">instrument_task</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;Wraps a celery task with statsd instrumentation code&quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">instrument_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>        <span class="n">stats_conn</span> <span class="o">=</span> <span class="n">statsd</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
</span><span class='line'>            <span class="n">host</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;STATSD_HOST&#39;</span><span class="p">],</span>
</span><span class='line'>            <span class="n">port</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;STATSD_PORT&#39;</span><span class="p">],</span>
</span><span class='line'>            <span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">task_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">counter</span> <span class="o">=</span> <span class="n">statsd</span><span class="o">.</span><span class="n">counter</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="s">&#39;celery.tasks.status&#39;</span><span class="p">,</span><span class="n">stats_conn</span><span class="p">)</span>
</span><span class='line'>        <span class="n">counter</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="s">&#39;{task_name}.started&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">timer</span> <span class="o">=</span> <span class="n">statsd</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s">&#39;celery.tasks.duration&#39;</span><span class="p">,</span> <span class="n">stats_conn</span><span class="p">)</span>
</span><span class='line'>        <span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span><span class="p">:</span>
</span><span class='line'>            <span class="n">counter</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="s">&#39;{task_name}.exceptions&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
</span><span class='line'>            <span class="k">raise</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">counter</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="s">&#39;{task_name}.success&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
</span><span class='line'>            <span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s">&#39;{task_name}.success&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">ret</span>
</span><span class='line'>        <span class="k">finally</span><span class="p">:</span>
</span><span class='line'>            <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                <span class="k">del</span> <span class="n">timer</span>
</span><span class='line'>                <span class="k">del</span> <span class="n">counter</span>
</span><span class='line'>                <span class="k">del</span> <span class="n">stats_conn</span>
</span><span class='line'>            <span class="k">except</span><span class="p">:</span>
</span><span class='line'>                <span class="k">pass</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">instrument_wrapper</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">simple_decorator</span><span class="p">(</span><span class="n">decorator</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;Borrowed from:</span>
</span><span class='line'><span class="sd">    http://wiki.python.org/moin/PythonDecoratorLibrary#Property_Definition</span>
</span><span class='line'>
</span><span class='line'><span class="sd">    Original docstring:</span>
</span><span class='line'><span class="sd">    This decorator can be used to turn simple functions</span>
</span><span class='line'><span class="sd">    into well-behaved decorators, so long as the decorators</span>
</span><span class='line'><span class="sd">    are fairly simple. If a decorator expects a function and</span>
</span><span class='line'><span class="sd">    returns a function (no descriptors), and if it doesn&#39;t</span>
</span><span class='line'><span class="sd">    modify function attributes or docstring, then it is</span>
</span><span class='line'><span class="sd">    eligible to use this. Simply apply @simple_decorator to</span>
</span><span class='line'><span class="sd">    your decorator and it will automatically preserve the</span>
</span><span class='line'><span class="sd">    docstring and function attributes of functions to which</span>
</span><span class='line'><span class="sd">    it is applied.&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">new_decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span><span class='line'>        <span class="n">g</span> <span class="o">=</span> <span class="n">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'>        <span class="n">g</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span>
</span><span class='line'>        <span class="n">g</span><span class="o">.</span><span class="n">__module__</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">__module__</span> <span class="c"># or celery throws a fit</span>
</span><span class='line'>        <span class="n">g</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">__doc__</span>
</span><span class='line'>        <span class="n">g</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">g</span>
</span><span class='line'>    <span class="c"># Now a few lines needed to make simple_decorator itself</span>
</span><span class='line'>    <span class="c"># be a well-behaved decorator.</span>
</span><span class='line'>    <span class="n">new_decorator</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="n">decorator</span><span class="o">.</span><span class="n">__name__</span>
</span><span class='line'>    <span class="n">new_decorator</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">decorator</span><span class="o">.</span><span class="n">__doc__</span>
</span><span class='line'>    <span class="n">new_decorator</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">decorator</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">new_decorator</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/we-have-the-tools-but-what-about-the-techniques/">We Have the Tools but What About the Techniques?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-02T00:00:00-08:00" pubdate data-updated="true">Jan 2<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1></h1>

<p>In my previously-written article “<a href="http://www.charleshooper.net/blog/concurrent-engineering-the-foundation-of-devops/" title="Concurrent Engineering: The Foundation of DevOps">Concurrent Engineering: The Foundation of DevOps</a>” I wrote “<em>just because you use puppet does not necessarily mean your organization is practicing DevOps.</em>” I didn’t spend much time on it then, but I think it bears repeating and further explanation. The <strong>DevOps “movement” has seen</strong>, and will likely continue to see, <strong>a huge influx of new tools</strong> as organizations attempt to find ways to adopt DevOps within their organizations. These tools have included (and certainly have not been limited to) tools that aid in monitoring (statsd), configuration management (puppet), and continuous delivery (hubot).</p>

<p>Operations engineers, software developers, and managers are in a mad dash to develop, utilize, and integrate these tools within their organizations. And that’s where we’re going wrong; we are focused on a single component of the Software/Systems Engineering Process. This process model contains three main components that are central to its existence: <em>methodologies</em>, <em>techniques</em>, and <em>tools</em> (Valacich 2009). While I don’t need to go into each one specifically, it’s clear that the tools are just a single factor in the overall process. Following the model further, it becomes clear that the makeup of each of these components influences the other components in the process.</p>

<p>Put simply, <strong>DevOps is a methodology</strong> and, as such, it’s natural that we’re seeing a huge response in tools. What I feel we’re missing, however, is more information about the different techniques used throughout organizations in <em>their</em> software and operations engineering processes. An excellent example of this is <a href="http://scottchacon.com/2011/08/31/github-flow.html">Scott Chacon’s explanation of how Github uses Git (and Github!) to deliver continuous improvement</a> to their service. With that said, I would like to see more organizations refine their techniques and talk about <em>these</em> as much as they talk about their tools.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
	<script type="text/javascript"><!--
		google_ad_client = "pub-9122341512723010";
		/* charleshooper.net sidebar */
		google_ad_slot = "2663139048";
		google_ad_width = 250;
		google_ad_height = 250;
		//-->
	</script>
	<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</section>
<section>
  <h1>About Charles</h1>
	<img src="/wp-content/uploads/me-150x150.jpg" alt="Charles Hooper"/>
	<p>Charles is a hacker with a background in systems and operations engineering. He enjoys hacking on side projects, gardening, and home brewing.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/catching-up/">Catching up</a>
      </li>
    
      <li class="post">
        <a href="/blog/intro-to-ops-metrics-collection/">Intro to Operations: Metrics Collection</a>
      </li>
    
      <li class="post">
        <a href="/blog/intro-to-ops-availability-monitoring-alerting/">Intro to Operations: Availability Monitoring and Alerting</a>
      </li>
    
      <li class="post">
        <a href="/blog/intro-to-ops-config-management/">Intro to Operations: Configuration Management</a>
      </li>
    
      <li class="post">
        <a href="/blog/new-platform/sorry-for-rss-spam/">New Platform - Sorry for the RSS Spam</a>
      </li>
    
  </ul>
</section>

<section>
	<script type="text/javascript"><!--
		google_ad_client = "pub-9122341512723010";
		/* charleshooper.net sidebar */
		google_ad_slot = "2663139048";
		google_ad_width = 250;
		google_ad_height = 250;
		//-->
	</script>
	<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Charles Hooper -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'charleshooper';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>


<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Charles Hooper</title>
  <meta name="author" content="Charles Hooper">

  
  <meta name="description" content="On any given day, there are a number of people discussing user requirements and
prioritizing the work ahead of them based on them. There’s an
oft- &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.charleshooper.net">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/subversity" rel="alternate" title="Charles Hooper" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12888528-1']);
    _gaq.push(['_trackPageview']);

    setTimeout("_gaq.push(['_trackEvent', '60_seconds', 'read'])", 60000);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Charles Hooper</a></h1>
  
    <h2>Thoughts and projects from a hacker and engineer</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/subversity" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.charleshooper.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
	<li><a href="/about/">About Charles</a></li>
	<li><a href="/projects/">Projects</a></li>
	<li><a href="/contact/">Contact</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/briefly-operator-requirements/">Briefly: Operator Requirements</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-11-23T10:49:00-08:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p>On any given day, there are a number of people discussing user requirements and
prioritizing the work ahead of them based on them. There’s an
oft-underrepresented group of users however and those are your operators.
Typically, the set of things needed by your operators are buried in your
project’s list of “non-functional requirements”, if at all.</p>

<p>In this brief, I would like to provide you with a de facto set of “operator
requirements” for your project. This list is likely incomplete and I’m
discovering more every day. I may update this post from time to time to add
things or clarify them as I journey towards understanding.</p>

<p>An application that satisfies these requirements will be more scalable, easier
to operate, and likely have a lower Mean Time To Recovery than an application
that does not.</p>

<ol>
  <li>
    <p>In general you should strive to adhere to <a href="http://12factor.net/">12factor</a> if you’re building a web
  application. 12factor creates a clean contract between your application and
  the operating system, enables simpler deployments, and results in applications
  that are mostly horizontally scalable by default. If you cannot adhere to
  12factor, then I would challenge you to borrow as much of it as you can before
  discounting the whole 12factor methodology.</p>
  </li>
  <li>
    <p>Your application should have plenty of <a href="http://www.charleshooper.net/blog/briefly-logs/">logging and follow best
  practices</a>.</p>
  </li>
  <li>
    <p>Your application should also emit metrics that create some sense of
  understanding of what the system is doing.</p>
  </li>
  <li>
    <p>Your application’s services should have <a href="http://www.charleshooper.net/blog/briefly-health-checks/">health checks</a>. The health checks
  should return HTTP 2xx or 3xx when the service is healthy and HTTP 5xx when
  it is not. The response body should contain an explanation or identifier that
  will allow the operator to determine why the health check failed to aid in
  incident recovery.</p>
  </li>
  <li>
    <p>Your application should use <a href="https://brandur.org/request-ids">unique request IDs</a> and add them to their
  logging contexts (see logging).</p>
  </li>
  <li>
    <p>Your application should support credential rotation. Any given secret,
  whether it’s a password, API key, SSL private key, or otherwise, should be
  changeable with minimal disruption to the service. This should be exercised
  often to ensure it works as designed.</p>
  </li>
  <li>
    <p>Your application should provide operators with <a href="http://blog.travis-ci.com/2014-03-04-use-feature-flags-to-ship-changes-with-confidence/">toggles or feature flags</a> —
  parameters that allow the operators or the system itself to turn off bits of
  functionality when the system is degraded.</p>
  </li>
  <li>
    <p>Your application should put external resources behind <a href="https://engineering.heroku.com/blogs/2015-06-30-improved-production-stability-with-circuit-breakers/">circuit breakers</a>.
  Circuit breakers allow your app to continue operating (albeit in a degraded
  state) when an external resource is unavailable instead of taking your
  application offline.</p>
  </li>
  <li>
    <p>Your application should be <a href="http://12factor.net/disposability">disposable and restartable</a>; this means that
  it’s restartable on the same instance or a new instance) after a crash and
  should crash in an automatically recoverable state. If your crash is not
  automatically recoverable, it should scream! In addition, your application
  should gracefully complete existing work such as HTTP requests or jobs it
  picked up from a task queue. In the case of long running jobs, your application
  should be able to abandon the work to have it picked up by another worker or
  node.</p>
  </li>
</ol>

<p>These are just a start but these requirements should be imported into your project’s
requirements and prioritized with maintainability in mind. By doing so, your
application will be more scalable, easier to operator, and have a lower Mean
Time To Recovery than application that don’t satisfy these requirements.</p>

<p>Do you feel like I missed anything? What else would you recommend?</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/briefly-health-checks/">Briefly: Health Checks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-11-08T01:23:00-08:00" pubdate data-updated="true">Nov 8<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p>Health checks are specially defined endpoints or routes in your application
that allow external monitors to determine the health of your web application.
They are so important to production health that I consider them the “13th
factor” in <a href="http://12factor.net/">12factor</a>.</p>

<p>If an application is healthy it will return a HTTP 2xx or 3xx status code and
when it is not it will return an HTTP 5xx status code.</p>

<p>This type of output allows load balancers to remove unhealthy instances from
its rotation but can also be used to alert an operator or even automatically
replace the instance.</p>

<p>In order to implement proper health checks, your application’s health checks
should:</p>

<ol>
  <li>
    <p>Return a HTTP 2xx or 3xx status code when healthy</p>
  </li>
  <li>
    <p>Return a HTTP 5xx status code when not healthy</p>
  </li>
  <li>
    <p>Include the reason why the check failed in the response body</p>
  </li>
  <li>
    <p><a href="http://www.charleshooper.net/blog/briefly-logs/">Log the requests and their results</a> along with Request IDs</p>
  </li>
  <li>
    <p>Not have any side effects</p>
  </li>
  <li>
    <p>Be lightweight and fast</p>
  </li>
</ol>

<p>If you implement health checks in your application following this advice,
you’ll have a more resilient, monitorable, and manageable application.</p>

<p>How about you all? Is there anything you would add?</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/briefly-logs/">Briefly: Logs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-10-29T05:47:00-07:00" pubdate data-updated="true">Oct 29<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p>Recently I was asked by another engineer what information I expect to be able
to find in logs. For this, I mostly agree with <a href="http://dev.splunk.com/view/logging-best-practices/SP-CAAADP6">Splunk’s best practices</a> but
I have some additional advice I want to provide. I’ll end up regurgitating some
of Splunk’s recommendations anyway.</p>

<ol>
  <li>
    <p>Your logs should be human readable. This means logging in text (no binary
logging) and in a format that can be read by angry humans. Splunk recommends
key-value pairs (e.g. <code>at=response code=200 bytes=1024</code>) since it makes
Splunking easy, but I don’t have a strong enough opinion to evangelize that.
Some folks advocate for logging in JSON but I don’t actually find JSON to be
very readable.</p>

    <p>Edit: Someone pointed out to me that this isn’t ideal when you have a large
amount of logs. They prefered sending JSON logs to a service like ElasticSearch
but I think also sending key-value pairs to Splunk is also reasonable at some
scale.</p>
  </li>
  <li>
    <p>Every log line should include a timestamp. The timestamp should be human
readable and in a standard format such as <a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a>/<a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a>.
Finally, even though the above specs include a timezone offset, timestamps
should be stated in UTC time whenever possible.</p>
  </li>
  <li>
    <p>Every log line should include a unique identifier for the work being
performed. In web applications and APIs, for example, this would be a
request ID. The combination of a unique ID and timestamp allows for developers
and operators to trace the execution of a single work unit.</p>
  </li>
  <li>
    <p>More is more. While I don’t particularly enjoy reading logs, I have always
been more happy when an application logs more information than I need versus
when an application doesn’t log enough information. Be verbose and log
everything.</p>
  </li>
  <li>
    <p>Make understanding the code path of a work unit easy. This means logging
file names, class names, function or method names, and so on. When sensible,
include the arguments to these things as well.</p>
  </li>
  <li>
    <p>Use one line per event. Multi-line events are bad because they are difficult
to grep or Splunk. Keep everything on one log line but feel free to log
additional events. An exception to this rule might be tracebacks (see what I
did there?)</p>
  </li>
  <li>
    <p>Log to stdout if you’re following <a href="http://12factor.net/">12factor</a> otherwise log to syslog. Do not
write your own log files! By writing your own log files, you are either
taking log rotation off the table or signing yourself up to support exciting
requirements like re-opening logs on SIGHUP (let’s not go there).</p>
  </li>
  <li>
    <p>Last but not least: <strong>Don’t write your own logging library!</strong> Chances are
there already exists a well thought-out and standard library available in
your application’s language or framework. Please use it!</p>
  </li>
</ol>

<p>So those are my recommendations about logs. What else would you recommend?</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/i-have-a-new-job-at-truss/">I Have a New Job at Truss!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-10-01T20:31:00-07:00" pubdate data-updated="true">Oct 1<span>st</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p>Two weeks ago I started a new job at <a href="http://truss.works/">Truss</a> after
leaving Heroku two months ago.</p>

<p>Working at Heroku was an amazing experience in many ways. I achieved
the highest level of work-life balance so far in my life, I had great
coaches, and I solved a lot of challenging and interesting problems.</p>

<p>But it’s time to move on so after a month and half of downtime I’ve
joined Truss as an operations engineer.</p>

<p>I joined Truss for a number of reasons:</p>

<ol>
  <li>
    <p>I wanted to consult again; consultants are given more ownership of
 the problems they are tasked with solving and there’s always something
 new to do</p>
  </li>
  <li>
    <p>I believe there is a ton of opportunity for infrastructure consulting
 and engineering, both in government and in private industry</p>
  </li>
  <li>
    <p>I wanted to work with the folks on this team in particlar</p>
  </li>
</ol>

<p>Thanks to all the folks who made my time at Heroku awesome and the folks who
have been most welcoming at Truss. I’m already enjoying working together!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/personal-archery-faq/">Personal Archery FAQ</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-24T06:33:00-07:00" pubdate data-updated="true">May 24<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p><img class="left" src="http://i.imgur.com/JgVVfCk.png" width="270" height="480" title="Archery" /></p>

<p>When people learn that I’m a traditional archer, they tend to ask me a number of
questions. I thought this might be a fun blog post, so here we go!</p>

<h2 id="how-far-do-i-shoot">How far do I shoot?</h2>

<p>I don’t shoot very far! Because I’m currently focused on form (more on
that below), I am only shooting from between ten to twenty meters.</p>

<h2 id="how-accurate-am-i">How accurate am I?</h2>

<p>I’m not at all because I’m currently focused on <em>precision</em>. This is
mostly a matter of form and consistency, which is why I don’t have to
“shoot” (“loose”? “let”?) from very far. I can spend an entire session
at 10 meters and get very rapid feedback on this, so I do. (Note: I’m
being pedantic about precision vs accuracy, explanation in the image
below).</p>

<p><img class="center" src="http://cdn.antarcticglaciers.org/wp-content/uploads/2013/11/precision_accuracy.png" width="417" height="278" title="&#34;Precision vs Accuracy&#34;" alt="&#34;Precision vs Accuracy&#34;" /></p>

<p>A variation of this question is sometimes if I’ve ever “robin hooded” an
arrow. <em>Robin hooding</em> is when you shoot one arrow back into another
one.</p>

<p><img src="http://i.imgur.com/vR2mAMo.png" alt="Not yet - arrow damage" /></p>

<p>My answer today is “not yet!”</p>

<h2 id="have-you-seen-the-video-of-that-danish-guy-lars-something-its-really-amazing">Have you seen the video of that Danish guy? Lars something? It’s really amazing!</h2>

<p>Ah yes, Lars Anderson. He’s done <a href="https://www.youtube.com/results?search_query=lars+anderson">a couple of
videos</a> but
<a href="https://www.youtube.com/watch?v=BEG-ly9tQGk">one in particular</a> has
gotten a lot of attention recently.</p>

<p>The videos are pretty amazing to watch and highly entertaining, but you
won’t find me doing those things any time soon. I’m perfectly content
right here.</p>

<p><img class="right" src="https://scontent.fsjc1-1.fna.fbcdn.net/hphotos-xfp1/v/t1.0-9/11209693_10153295331296703_5424043068009224924_n.jpg?oh=9a0a04c3728c5ed68e5efa6708708160&amp;oe=56035DA8" width="270" height="480" title="&#34;Archery point of view&#34;" alt="&#34;Archery point of view&#34;" /></p>

<h2 id="where-do-i-go">Where do I go?</h2>

<p>There’s an <a href="http://www.golden-gate-park.com/archery.html">archery range in Golden Gate
Park</a> which is free to
use. Nearby is the <a href="http://www.bysel.com/sfarch/">San Francisco Archery Pro
Shop</a> which has good lessons and cheap
all-day rentals.</p>

<h2 id="how-did-i-get-started">How did I get started?</h2>

<p>I had been interested in archery for several years but it wasn’t until a
couple of months ago that I finally tried it.</p>

<p>I went to a <a href="http://www.bysel.com/sfarch/">local shop</a> and took my first
lesson. It was so much fun that I took another one and, when I tried to
sign up for my third, my instructor suggested that I should make some
time to practice all of the things I’ve just learned on my own.</p>

<p>So I rented the equipment a few times and eventually just bought my own.</p>

<h2 id="what-did-you-buy">What did you buy?</h2>

<p>I bought a pretty basic recurve bow and everything else I needed:</p>

<ul>
  <li>
    <p>Six arrows</p>
  </li>
  <li>
    <p>A quiver</p>
  </li>
  <li>
    <p>An arm guard and glove</p>
  </li>
  <li>
    <p>A bow stringer</p>
  </li>
  <li>
    <p>Target pins</p>
  </li>
  <li>
    <p>And carrying bag</p>
  </li>
</ul>

<p>All in all, it cost me about $350.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/what-am-i-supposed-to-do-with-all-of-this-honey/">What Am I Supposed to Do With All of This Honey?!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-04T13:56:00-08:00" pubdate data-updated="true">Jan 4<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p><img src="https://farm8.staticflickr.com/7581/16173441916_fab90e3b9a_z_d.jpg" alt="Two gallons of honey" /></p>

<p>For Christmas this year, one of the wonderful gifts I received was this
two gallon bucket full of fresh, local honey. My friend, the gift giver,
offered the suggestion of brewing some mead which is too sweet for my
tastes. So what should I do with it then?</p>

<p>I thought I’d <a href="https://byo.com/light-ale/item/322-brewing-with-honey">brew some beer with it</a> but two gallons of pure honey (or
whatever that translates to in weight) is alot of honey and, since I’m
currently only doing one gallon batches of home brewed beer, it’ll take take
quite a bit of homebrew to get through it all.</p>

<p>A quick <a href="http://www.saveur.com/find/honey">search for honey recipes</a> yields some interesting ideas as
well, with the top contender being these <a href="http://www.saveur.com/article/Recipes/Sweet-and-Sour-Glazed-Pork-Chops-Maiale-in-Agrodolce">sweet and sour glazed pork
chops</a>.</p>

<p>So what do you think? What should I do with all this honey?</p>

<p><img src="https://farm9.staticflickr.com/8649/16011801388_d11c149b1c_z_d.jpg" alt="Two gallons of honey" /></p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/give-it-a-rest/">Give It a Rest</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-03T18:00:00-08:00" pubdate data-updated="true">Jan 3<span>rd</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p><img src="https://farm9.staticflickr.com/8649/16189710525_1191b9eb7f_z_d.jpg" alt="Dying zucchini (courgette)" /></p>

<p>Yesterday I walked out to my yard to find that all of my zucchini
(courgette) plants are dying. It was cold enough the night before to
kill them all at once and there really isn’t any saving them.</p>

<p>We got greedy at first and wanted to reclaim the wasted space, until we
realized that our garden has been running strong for about 9 months now,
since Erica and I planted our first seeds of the season in March of last
year. Now we’ve decided to give it a rest so we can add some new compost to
fortify the soil.</p>

<p>For me, the dying zucchini plants serve as a reminder that nature
intends for us to rest and will find a way to see that we do (sometimes
permanently). Plants drop seed, decompose, and ultimately end up feeding
their offspring. Animals need to eat and sleep.</p>

<p><img src="https://farm8.staticflickr.com/7541/15568029134_2263d267b9_z_d.jpg" alt="Caesar not sleeping" /></p>

<p>It’s a new year and you likely just had some time off that wasn’t very
restful. If you’re like me, you were probably busy traveling, shopping,
worrying about money, or the holidays may even open up some new wounds
for you. Don’t accept this as your vacation for the year.</p>

<p>Your real vacation should be about rest and relaxation. You can travel
or you can stay home, but the bottom line is that you should be
relaxing. Sleep in some days if you’d like. When you’re awake, maybe
read a book, go for a walk, or take up that hobby you’ve been thinking
about. On my last stay-cation, I tried our archery for the first time
and have been hooked ever since.</p>

<p>So start planning your time off now. Trust me, it’s worth it.</p>

<p><img src="https://farm8.staticflickr.com/7542/15570698153_05774d7eb9_z_d.jpg" alt="First archery target" /></p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/on-slack-and-upkeep/">On Slack and Upkeep</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-08T14:22:00-07:00" pubdate data-updated="true">Aug 8<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p>A term I hear often in the context of engineering and project management
is “slack.” It’s often used to refer to a magical pool of time that all
of a service’s upkeep, including maintenance and operations, is going to
come out of. This is wrong though. Here’s why:</p>

<ul>
  <li>
    <p>That’s not what slack is for</p>
  </li>
  <li>
    <p>Mismanaged slack is equivalent to non-existent slack</p>
  </li>
</ul>

<h2 id="what-is-it-then">What is it then?</h2>

<p>I subscribe to the definition in
<a href="http://www.amazon.com/Slack-Getting-Burnout-Busywork-Efficiency/dp/0767907698">Tom DeMarco’s Slack</a>,
which is “the degree of freedom required to effect change.”</p>

<p>Slack is something you maintain so that your team is responsive and adaptable,
it is <em>not</em> “extra time” or “maintenance time.” If you are doing this, you are
effectively allocating that time and thus <em>eliminating your slack pool.</em> Signs
you or your team may be guilty of this:</p>

<ul>
  <li>
    <p>You don’t make explicit allocations of time to operations or
maintenance upkeep</p>
  </li>
  <li>
    <p>You don’t “have enough time” to properly operate or maintain your
services</p>
  </li>
  <li>
    <p>You can’t solve problems or complete remediation items identified by your
organization’s problem management program</p>
  </li>
</ul>

<h2 id="so-i-should-do-nothing-then">So I should do nothing then?</h2>

<p>Well, no. At least <em>some</em> of your slack needs to be spent idle though.
Remember that the concept of slack is rooted in queueing theory. There’s
a well-known relationship between utilization and response time. This
relationship is <em>exponential:</em> The higher utilized your team is, the
<em>much</em> higher your response time is! You can see it for yourself
below:</p>

<p><img src="/images/posts/util_response_rel.png" alt="Relationship between utilization and response time" /></p>

<p>We can tell by looking at this graph that our responsiveness falls apart
at about 70% utilization which means you should keep at least 30% of
your time <em>unallocated</em>.</p>

<h2 id="unallocated-why-cant-i-just-devote-30-of-my-time-to-upkeep">Unallocated? Why can’t I just devote 30% of my time to upkeep?</h2>

<p>Because upkeep, the maintenance and operations of your service,
are <em>required</em> activities. Entropy means that, unkept, your service will
degrade over time. This entropy is accelerated if your service is
experiencing growth. Your databases will bloat, your latency will
increase, your 99.99% success rate will fall to 99.9% (or worse), your
service will be difficult to add features to, and eventually your users
will go somewhere else.</p>

<p>Instead of thinking about it like this:</p>

<p><img src="/images/posts/slack_wrong_way.png" alt="Wrong way to manage slack" /></p>

<p>Think about it like <em>this</em>:</p>

<p><img src="/images/posts/slack_right_way.png" alt="Right way to manage slack" /></p>

<p>In this model, you explicitly allocate time to upkeep <em>and</em> maintain a
slack pool.</p>

<h2 id="how-much-time-should-i-spend-on-upkeep-versus-product-and-feature-work">How much time should I spend on upkeep versus product and feature work?</h2>

<p>I don’t have a good guideline for you, sorry. You’ll need to determine
this based on your organization’s or team’s goals and any SLAs you may
have.</p>

<p>For example, if you’re operating a service with a service-level
objective of meeting a 99.99% success rate (0.01% error rate) then you
need to allocate more time to upkeep than a service targetting a 99.9%
success rate, generally speaking.</p>

<p>Note that this will change and vary over time. If you’re already deep in
technical debt, your upkeep allocation will need to be much higher to
pay off some of your principal. Once you’ve done that, you’ll probably
be able to meet your goals with a much lower allocation later on.</p>

<h2 id="call-to-action">Call to action</h2>

<p>I urge everyone to start thinking about slack and upkeep this way. Take a
close look at your team’s goals and commitments and explicitly allocate time
for reaching those goals. Doing so will allow your team to properly maintain
the services which it operates while
also being very responsive.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/what-i-do-sre/">What I Do as an SRE</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-21T06:02:00-07:00" pubdate data-updated="true">Jun 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p>Sometimes people ask me what I do and I’m not really sure how to answer
them. My answer tends to depend on social setting, what I’ve been
working on, and if I was on call that week. No matter the circumstances,
it usually comes out pretty boring and terribly short.</p>

<p>This really sucks though, because I actually really <em>like</em> my job and
think that it’s interesting, if only I could articulate it.</p>

<p>So here’s some attempt at explaining what I do:</p>

<ul>
  <li>
    <p>I’m an SRE, or <em>Service Reliability Engineer</em>,
at <a href="https://www.heroku.com/">Heroku</a>. Typically, SRE stands for <em>Site</em>
Reliability Engineer, however we’ve modernized it at Heroku because what
is even a site anymore?</p>
  </li>
  <li>
    <p>My week-to-week is wildly unpredictable. This week I’m conducting an
operational review of one of our key platform components, last week I
was investigating and addressing database bloat, and the week before I
was the on-call incident commander and quite busy due to several
incidents that occurred.</p>
  </li>
  <li>
    <p>Speaking of the incident commander role, part of my job includes
<em>defining</em> how we respond to incidents. At first glance it seems easy:
Get paged and show up. And then you respond to your first 24-hour
slow-burning incident and realize that you’ve got more work to do.</p>
  </li>
  <li>
    <p>Following incidents, I also schedule and faciliate retrospectives. We
practice <a href="http://codeascraft.com/2012/05/22/blameless-postmortems/">blameless
postmortems</a>
and these tend to be incredibly constructive.</p>
  </li>
  <li>
    <p>I also analyze past incident data and look for patterns and trends.
Wondering if there’s a day of week that has a higher probability of
experiencing an incident? Yeah, it’s Friday.</p>
  </li>
  <li>
    <p>When all is quiet, I review dashboards and investigate anomolies.
Wondering what that weird spike or dip is that seems to happen every
once in a while? Ask me, I’ve probably pulled that thread before (and if
I haven’t, I’ll be terribly curious).</p>
  </li>
  <li>
    <p>And sometimes I build integration tests and tools. I wrote
<a href="/blog/troubleshooting-elbs-with-elbping/">elbping</a>, for instance,
because ELBs were terrible to troubleshoot during an incident.</p>
  </li>
  <li>
    <p>And, most importantly, I mentor other SREs and software engineers.
This is the single biggest thing I can do in terms of its impact, and
probably most rewarding, too.</p>
  </li>
</ul>

<p>So there you have it, that’s what I do.</p>

<p>P.S. - If this sounds interesting to you, <a href="http://jobs.heroku.com/">we’re hiring</a>!</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/troubleshooting-elbs-with-elbping/">Troubleshooting ELBs With Elbping</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-19T10:49:00-07:00" pubdate data-updated="true">Oct 19<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="section"></h1>

<p>Troubleshooting ELBs can be pretty painful at times because they are
largely a black box. There aren’t many metrics available, and the ones
that do exist are aggregated across all of the nodes of an ELB. This can
be troublesome at times, for example when only a subset of an ELB’s
nodes are degraded.</p>

<h1 id="elb-properties">ELB Properties</h1>

<p>ELBs have some interesting properties. For instance:</p>

<ul>
  <li>ELBs are made up of 1 or more nodes</li>
  <li>These nodes are published as A records for the ELB name</li>
  <li>These nodes can fail, or be shut down, and connections will <em>not</em> be closed gracefully</li>
  <li>It often requires a good relationship with Amazon support ($$$) to get someone to dig into ELB problems</li>
</ul>

<p><em>NOTE: Another interesting property but slightly less pertinent is that
ELBs were not designed to handle sudden spikes of traffic. They
typically require 15 minutes of heavy traffic before they will scale up
or they can be pre-warmed on request via a support ticket</em></p>

<h1 id="troubleshooting-elbs-manually">Troubleshooting ELBs (manually)</h1>

<p><strong>Update:</strong> <em>Since writing this blog post, AWS has since migrated all
ELBs to use Route 53 for DNS. In addition, all ELBs now have a
<code>all.$elb_name</code> record that will return the full list of nodes for the
ELB. For example, if your ELB name is
<code>elb-123456789.us-east-1.elb.amazonaws.com</code>, then you would get the full
list of nodes by doing something like <code>dig
all.elb-123456789.us-east-1.elb.amazonaws.com</code>. In addition, Route 53 is
able to return up to 4KB of data still using UDP, so using the <code>+tcp</code>
flag may not be necessary.</em></p>

<p>Knowing this, you can do a little bit of troubleshooting on your own.
First, resolve the ELB name to a list of nodes (as A records):</p>

<pre><code>$ dig @ns-942.amazon.com +tcp elb-123456789.us-east-1.elb.amazonaws.com ANY
</code></pre>

<p>The <code>tcp</code> flag is suggested as your ELB could have too many records to fit
inside of a single UDP packet. You also need to perform an <code>ANY</code> query because
Amazon’s nameservers will only return a subset of the nodes otherwise.  Running
this command will give you output that looks something like this (trimmed for
brevity):</p>

<pre><code>;; ANSWER SECTION:
elb-123456789.us-east-1.elb.amazonaws.com. 60 IN SOA ns-942.amazon.com. root.amazon.com. 1376719867 3600 900 7776000 60
elb-123456789.us-east-1.elb.amazonaws.com. 600 IN NS ns-942.amazon.com.
elb-123456789.us-east-1.elb.amazonaws.com. 60 IN A 54.243.63.96
elb-123456789.us-east-1.elb.amazonaws.com. 60 IN A 23.21.73.53
</code></pre>

<p>Now, for each of the <code>A</code> records use e.g. <code>curl</code> to test a connection to
the ELB. Of course, you also want to isolate your test to just the ELB
without connecting to your backends. One final property and little known
fact about ELBs:</p>

<ul>
  <li>The maximum size of the request method (verb) that can be sent through an ELB is <strong>127 characters</strong>. Any larger and the ELB will reply with an <em>HTTP 405 - Method not allowed</em>.</li>
</ul>

<p>This means that we can take advantage of this behavior to test only that
the ELB is responding:</p>

<pre><code>$ curl -X $(python -c 'print "A" * 128') -i http://ip.of.individual.node
HTTP/1.1 405 METHOD_NOT_ALLOWED
Content-Length: 0
Connection: Close
</code></pre>

<p>If you see <code>HTTP/1.1 405 METHOD_NOT_ALLOWED</code> then the ELB is responding
successfully. You might also want to adjust curl’s timeouts to values
that are acceptable to you.</p>

<h1 id="troubleshooting-elbs-using-elbping">Troubleshooting ELBs using elbping</h1>

<p>Of course, doing this can get pretty tedious so I’ve built a tool to
automate this called <a href="https://github.com/heroku/elbping">elbping</a>. It’s
available as a ruby gem, so if you have rubygems then you can install it
by simply doing:</p>

<pre><code>$ gem install elbping
</code></pre>

<p>Now you can run:</p>

<pre><code>$ elbping -c 4 http://elb-123456789.us-east-1.elb.amazonaws.com
Response from 54.243.63.96: code=405 time=210 ms
Response from 23.21.73.53: code=405 time=189 ms
Response from 54.243.63.96: code=405 time=191 ms
Response from 23.21.73.53: code=405 time=188 ms
Response from 54.243.63.96: code=405 time=190 ms
Response from 23.21.73.53: code=405 time=192 ms
Response from 54.243.63.96: code=405 time=187 ms
Response from 23.21.73.53: code=405 time=189 ms
--- 54.243.63.96 statistics ---
4 requests, 4 responses, 0% loss
min/avg/max = 187/163/210 ms
--- 23.21.73.53 statistics ---
4 requests, 4 responses, 0% loss
min/avg/max = 188/189/192 ms
--- total statistics ---
8 requests, 8 responses, 0% loss
min/avg/max = 188/189/192 ms
</code></pre>

<p>Remember, if you see <code>code=405</code> then that means that the ELB is responding.</p>

<h1 id="next-steps">Next Steps</h1>

<p>Whichever method you choose, you will at least know if your ELB’s nodes
are responding or not. Armed with this knowledge, you can either turn
your focus to troubleshooting other parts of your stack or be able to
make a pretty reasonable case to AWS that something is wrong.</p>

<p>Hope this helps!</p>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <!-- Ads removed -->
</section>
<section>
  <h1>About Charles</h1>
	<img src="http://www.gravatar.com/avatar/9f645d339b731bc99a95704ad4289aac.png?size=160" alt="Charles Hooper"/>
	<p>Charles is a systems and reliability engineer. He enjoys archery, smoking meat, gardening, home brewing, and hacking.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/briefly-operator-requirements/">Briefly: Operator Requirements</a>
      </li>
    
      <li class="post">
        <a href="/blog/briefly-health-checks/">Briefly: Health Checks</a>
      </li>
    
      <li class="post">
        <a href="/blog/briefly-logs/">Briefly: Logs</a>
      </li>
    
      <li class="post">
        <a href="/blog/i-have-a-new-job-at-truss/">I have a new job at Truss!</a>
      </li>
    
      <li class="post">
        <a href="/blog/personal-archery-faq/">Personal Archery FAQ</a>
      </li>
    
  </ul>
</section>

<section>
  <!-- Ads removed -->
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Charles Hooper -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'charleshooper';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
